# Android App

This directory contains the Android native project for MyContracts, generated by Capacitor.

## Building the APK

### From the root of the repository:
```bash
cd frontend
npm run build
npx cap sync android
cd android
./gradlew assembleRelease
```

The APK will be generated at: `app/build/outputs/apk/release/app-release.apk`

### Using the npm script:
```bash
cd frontend
npm run cap:build:android
```

## APK Signing

The current configuration builds an **unsigned APK** suitable for development and testing.

For production releases, you need to configure APK signing:

1. Generate a keystore:
```bash
keytool -genkey -v -keystore mycontracts-release-key.keystore -alias mycontracts -keyalg RSA -keysize 2048 -validity 10000
```

2. Add signing configuration to `app/build.gradle`:
```gradle
android {
    ...
    signingConfigs {
        release {
            storeFile file("path/to/mycontracts-release-key.keystore")
            storePassword System.getenv("KEYSTORE_PASSWORD")
            keyAlias "mycontracts"
            keyPassword System.getenv("KEY_PASSWORD")
        }
    }
    buildTypes {
        release {
            signingConfig signingConfigs.release
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
}
```

3. Set environment variables before building:
```bash
export KEYSTORE_PASSWORD="your-keystore-password"
export KEY_PASSWORD="your-key-password"
./gradlew assembleRelease
```

## Opening in Android Studio

```bash
cd frontend
npm run cap:open:android
```

This will open the project in Android Studio where you can run it on an emulator or connected device.

## Configuring Backend URL

The Android app needs to connect to a running backend server. There are two approaches:

### Option 1: Development Mode (Live Reload)
For development, configure the backend URL in `capacitor.config.ts`:

```typescript
server: {
  url: 'http://10.0.2.2:8080',  // For Android emulator
  // OR
  url: 'http://192.168.1.100:8080',  // For physical device (use your computer's IP)
  cleartext: true  // Required for HTTP (not HTTPS)
}
```

### Option 2: Production Build (Bundled)
For production, the web files are bundled into the APK. The frontend will need to be configured to point to your production backend URL. You can:

1. Set the backend URL as an environment variable during build:
```bash
VITE_API_URL=https://your-backend-url.com npm run build
```

2. Update the frontend code to use this environment variable

After changing the backend URL configuration, rebuild and sync:
```bash
npm run build
npx cap sync android
```

## CI/CD Integration

The GitHub Actions workflow automatically builds the APK on every merge to `main` or `development` branches. The APK is available as a release artifact.

**Note:** The CI/CD builds produce unsigned APKs. To sign APKs in CI/CD, add the keystore and passwords as GitHub Secrets and configure the workflow accordingly.
